<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Búsqueda de Respuestas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>

    <div class="container py-4">
        <h2 class="text-center">GRUPOS VULNERABLES</h2>
        <div class="row mb-4">
            <div class="col-md-6 offset-md-3">
                <form id="searchForm">
                    <div class="mb-4">
                        <!-- <label for="grupoVulnerable" class="form-label">Selecciona un grupo vulnerable:</label> -->
                        <select id="grupoVulnerable" name="grupoVulnerable" class="form-select" required>
                            <option value="" disabled selected>Selecciona un grupo</option>
                            <option value="paternal">Paternal</option>
                            <option value="economico">Economico</option>
                            <option value="salud">Salud</option>
                            <option value="baja">Deserción Académica</option>
                            <option value="etnia">Población Indígena Linguística</option>
                            <!-- Más opciones de grupos se pueden agregar aquí -->
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Buscar</button>
                </form>
                
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <!-- Campo de búsqueda -->
                <div class="mb-3">
                    <!-- <label for="searchInput" class="form-label">Buscar en resultados:</label> -->
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar...">
                </div>
        
                <table class="table table-striped" id="resultTable">
                    <thead>
                        <tr>
                            <th>Matrícula</th>
                            <th>Nombre Completo</th>
                            <th>Email</th>
                            <th>Grupo Vulnerable</th>
                            <th>Pregunta</th>
                            <th>Respuesta</th>
                            <th>Observaciones</th>
                            <th>Fecha de Respuesta</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Aquí se cargarán los resultados -->
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>$(document).ready(function () {
        $('#searchForm').on('submit', function (e) {
            e.preventDefault(); // Evitar recargar la página
    
            const grupoVulnerable = $('#grupoVulnerable').val();
    
            // Validar que se seleccionó un grupo
            if (!grupoVulnerable) {
                alert('Por favor selecciona un grupo vulnerable.');
                return;
            }
    
            // Enviar petición AJAX
            $.ajax({
                url: '../../../app/Controllers/GruposV/buscar_respuestas.php',
                type: 'POST',
                data: { grupo_vulnerable: grupoVulnerable },
                dataType: 'json',
                success: function (data) {
                    const tbody = $('#resultTable tbody');
                    tbody.empty(); // Limpiar la tabla
    
                    if (data.length > 0) {
                        data.forEach(function (respuesta) {
                            tbody.append(`
                                <tr>
                                    <td>${respuesta.matricula}</td>
                                    <td>${respuesta.nombre_completo}</td>
                                    <td>${respuesta.email}</td>
                                    <td>${respuesta.grupo_vulnerable}</td>
                                    <td>${respuesta.pregunta}</td>
                                    <td>${respuesta.respuesta}</td>
                                    <td>${respuesta.respuesta}</td>
                                    <td>${respuesta.created_at}</td>
                                </tr>
                            `);
                        });
                    } else {
                        tbody.append('<tr><td colspan="8" class="text-center">No se encontraron resultados</td></tr>');
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Estado: " + status);
                    console.error("Error: " + error);
                    console.error("Respuesta del servidor: " + xhr.responseText);
                    alert('Error al buscar respuestas: ' + error + '. Detalles: ' + xhr.responseText);
                }
            });
        });
    
        // Función para filtrar la tabla según lo que escriba el usuario
        $('#searchInput').on('input', function () {
            var value = $(this).val().toLowerCase(); // Obtener el valor del input en minúsculas
            $('#resultTable tbody tr').filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1); // Filtrar filas
            });
        });
    });
    
    </script>
</body>
</html>
